<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Android ANR</title>
  </head>

  <body>
    <h1>Cause Android ANR</h1>

    <h2>Counter: <span id="counter">?</span></h2>

    <input
      type="button"
      value="Click me to add 1"
      width="500"
      height="200"
      onclick="increase()"
    />
    <br />
    <br />

    <input type="button" value="Click me to ANR" onclick="startANR()" />

    <script type="text/javascript">
      /*
    This is an example of a memory leak. A new property is added to the cache
    object 10 times/second. The value of performance.memory.usedJSHeapSize
    steadily increases.

    Since the value of cache[key] is easy to recalculate, we might want to free
    that memory if it becomes low. However, there is no way to do that...

    Another method to manually clear the cache could be added, but manually
    adding memory checks adds a lot of extra code and overhead. It would be
    nice if we could clear the cache automatically only when memory became low.

    Thus the solution presented at Google I/O!
    */

      function startANR() {
        while (true) {}
      }

      var i = 0;
      var ctr = document.getElementById("counter");
      function increase() {
        ctr.innerHTML = i++;
      }
    </script>
  </body>
</html>
